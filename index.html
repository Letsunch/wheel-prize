<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ABSA Prize Wheel</title>
<style>
  :root{
    /* ABSA Brand */
    --absa-red: #E41E2D;
    --absa-red-2:#c11a26;
    --absa-dark:#000000;
    --absa-gray:#333333;
    --absa-light:#F5F5F5;
    --absa-gold:#FFC72C;
    --absa-silver:#D9D9D9;

    /* Theme */
    --bg: var(--absa-light);
    --panel:#ffffff;
    --panel-2:#f3f3f3;
    --text: var(--absa-dark);
    --muted:#666;
    --ring:#e6e6e6;

    /* Wheel */
    --wheel-size:min(76vmin, 640px);
    --hub-size: 96px;
    --pointer-size: 36px;

    /* Motion */
    --spin-ms: 4300ms;
    --bezier: cubic-bezier(.15,.9,.1,1);

    /* Depth */
    --shadow-1: 0 6px 14px rgba(0,0,0,.12);
    --shadow-2: 0 14px 30px rgba(0,0,0,.16);
    --focus: 0 0 0 3px rgba(228,30,45,.15), 0 0 0 6px rgba(228,30,45,.12);
  }

  @media (prefers-color-scheme: dark){
    :root{
      --bg: #0e0e0f;
      --panel:#121213;
      --panel-2:#1a1a1b;
      --text:#f7f7f7;
      --muted:#b4b4b4;
      --ring:#262627;
    }
  }

  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    color:var(--text);
    background:
      radial-gradient(1200px 800px at 50% -10%, rgba(228,30,45,.12), transparent 60%),
      radial-gradient(900px 600px at 10% 120%, rgba(0,0,0,.08), transparent 60%),
      var(--bg);
    display:grid;
    place-items:center;
    padding:22px;
  }

  .app{
    width:min(100%, 1080px);
    display:grid;
    gap:24px;
    justify-items:center;
    text-align:center;
  }

  /* Header bar */
  .absa-header{
    width:100%;
    background: linear-gradient(180deg,#0f0f10, #000);
    color:#fff;
    padding:14px 18px;
    border-radius:16px;
    display:flex; align-items:center; justify-content:center; gap:12px;
    box-shadow: var(--shadow-1);
    border:1px solid rgba(255,255,255,.06);
  }
  .absa-logo{
    font-weight:900;
    font-size:24px;
    letter-spacing:.6px;
  }
  .absa-logo span{ color:var(--absa-red) }

  header h1{
    margin:0 0 6px 0;
    font-size:clamp(26px,3.8vmin,38px);
    font-weight:900;
    letter-spacing:.2px;
    background: linear-gradient(180deg, var(--absa-red), var(--absa-red-2));
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .sub{
    margin:0;
    color:var(--muted);
    font-size:clamp(14px,2vmin,17px);
    max-width: 680px;
    line-height:1.55;
  }

  /* Stage */
  .stage{
    position:relative;
    width:var(--wheel-size);
    aspect-ratio:1/1;
    display:grid; place-items:center;
  }

  /* Wheel wrapper with drop shadow + subtle base */
  .wheel-wrap{
    position:absolute; inset:0;
    display:grid; place-items:center;
    filter: drop-shadow(0 14px 28px rgba(0,0,0,.18));
  }
  /* nice base ring shadow */
  .wheel-wrap::after{
    content:"";
    position:absolute; inset:4%;
    border-radius:50%;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.08), inset 0 0 32px rgba(0,0,0,.06);
    pointer-events:none;
  }

  /* Pointer (polished brass vibe) */
  .pointer{
    position:absolute; top:-2px; left:50%;
    transform: translateX(-50%) rotate(180deg);
    width:0; height:0;
    border-left: var(--pointer-size) solid transparent;
    border-right: var(--pointer-size) solid transparent;
    border-bottom: calc(var(--pointer-size) * 1.62) solid var(--absa-gold);
    filter: drop-shadow(0 6px 12px rgba(0,0,0,.25));
    z-index:6;
  }
  .pointer::before{
    content:"";
    position:absolute; left:calc(-.5 * var(--pointer-size) + 2px); top:calc(var(--pointer-size) * 1.1);
    width: calc(var(--pointer-size) - 4px); height: calc(var(--pointer-size) - 4px);
    border-radius:50%;
    background: radial-gradient(120% 120% at 30% 30%, #fff 0%, #f7f7f7 40%, #bbb 100%);
    outline: 2px solid rgba(0,0,0,.25);
    box-shadow: inset 0 2px 2px rgba(255,255,255,.45), inset 0 -3px 6px rgba(0,0,0,.25);
  }

  /* stop wobble while spinning so the dot doesn't bob */
  .spinning .pointer{
    animation: none;
  }

  /* Controls */
  .controls{
    display:flex; flex-wrap:wrap; gap:14px 16px; justify-content:center; align-items:center;
    background: linear-gradient(180deg, var(--panel), var(--panel-2));
    padding:18px 20px;
    border-radius:16px;
    box-shadow: var(--shadow-1);
    border: 1px solid var(--ring);
    width:min(100%, 820px);
    backdrop-filter: saturate(1.2);
  }
  button{
    appearance:none; border:0; cursor:pointer;
    padding:14px 22px; border-radius:12px;
    font-weight:800; letter-spacing:.2px;
    background: linear-gradient(180deg, var(--absa-red), var(--absa-red-2));
    color:white;
    box-shadow: 0 8px 16px rgba(228,30,45,.25);
    transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
    min-width: 148px;
  }
  button:hover{ 
    transform: translateY(-1px);
    box-shadow: 0 10px 18px rgba(228,30,45,.3);
    filter: saturate(1.02);
  }
  button:active{ transform: translateY(0) scale(.99) }
  button[disabled]{ opacity:.65; cursor:not-allowed; filter:grayscale(.1) }
  button:focus-visible{ outline:none; box-shadow: var(--focus) }

  #resetBtn{
    background: linear-gradient(180deg, #3b3b3b, #202020);
    box-shadow: 0 8px 16px rgba(0,0,0,.25);
  }
  #resetBtn:hover{ filter:brightness(1.02) }

  .readout{ 
    flex: 1 1 320px; 
    text-align:center; 
    color:var(--muted); 
    font-weight:700;
    padding: 10px 12px;
    background: var(--panel-2);
    border-radius: 10px;
    border:1px solid var(--ring);
  }
  .readout strong{ color:var(--absa-red) }

  /* Toast */
  .toast{
    position:fixed; left:50%; bottom:22px; transform:translateX(-50%) translateY(18px);
    background: var(--panel);
    color:var(--text); 
    border-radius:14px; 
    padding:16px 20px;
    box-shadow: var(--shadow-2);
    border: 1px solid var(--ring);
    opacity:0; 
    pointer-events:none; 
    transition: all .35s var(--bezier);
    max-width:min(92vw, 620px);
    font-weight: 800;
    text-align: center;
    z-index: 100;
  }
  .toast.win{
    background: linear-gradient(180deg, var(--absa-red), var(--absa-red-2));
    color: white;
    border-color: rgba(255,255,255,.22);
    text-shadow: 0 1px 0 rgba(0,0,0,.25);
  }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(0) }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce){
    :root{ --spin-ms: 1400ms }
    .spinning .pointer{ animation:none }
    *{ scroll-behavior:auto !important }
  }

  /* Mobile tweaks */
  @media (max-width: 640px) {
    .controls{ flex-direction: column }
    .readout{ order:3; width:100% }
  }

  /* SVG text legibility chip */
  .label-chip{
    fill: rgba(255,255,255,.92);
    stroke: rgba(0,0,0,.10);
    stroke-width:.3;
    rx:4; ry:4;
  }

  /* Focus visible on the main buttons for keyboard users */
  #spinBtn:focus-visible, #resetBtn:focus-visible{
    outline:none; box-shadow: var(--focus);
  }

  /* (Unused now) wobble animation kept for reference
  .spinning .pointer{ animation: wobble .26s ease-in-out infinite; transform-origin: 50% 120%; }
  @keyframes wobble{
    0%,100%{ transform: translateX(-50%) rotate(178deg) }
    50%{ transform: translateX(-50%) rotate(182deg) }
  } */
</style>
</head>
<body>
  <main class="app" role="main" aria-label="ABSA Prize Wheel">
    <div class="absa-header" role="banner">
      <div class="absa-logo" aria-label="ABSA Bank">ABSA<span>‚Ä¢</span>BANK</div>
    </div>
    
    <header>
      <h1>ABSA Prize Wheel</h1>
      <p class="sub">Spin to win classic rewards. Four prizes plus ‚ÄúTry Again‚Äù and ‚ÄúExtra Spin‚Äù. Simple. Fair. Fun.</p>
    </header>

    <section class="stage" aria-live="polite">
      <div class="pointer" aria-hidden="true"></div>

      <!-- Confetti layer -->
      <canvas id="confetti"></canvas>

      <!-- SVG Wheel -->
      <div class="wheel-wrap" aria-hidden="false">
        <svg id="wheel" width="100%" height="100%" viewBox="-50 -50 100 100" role="img" aria-label="Prize wheel with 8 segments">
          <defs>
            <!-- rim -->
            <radialGradient id="rim" cx="50%" cy="50%" r="60%">
              <stop offset="0%" stop-color="#ffffff"/>
              <stop offset="60%" stop-color="#f3f3f3"/>
              <stop offset="100%" stop-color="#e9e9e9"/>
            </radialGradient>
            <!-- red -->
            <linearGradient id="absa-red-grad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#E41E2D"/>
              <stop offset="100%" stop-color="#c11a26"/>
            </linearGradient>
            <!-- gloss -->
            <radialGradient id="gloss" cx="30%" cy="30%" r="70%">
              <stop offset="0%" stop-color="white" stop-opacity="0.22"/>
              <stop offset="100%" stop-color="white" stop-opacity="0"/>
            </radialGradient>
            <!-- inner ring sheen -->
            <radialGradient id="inner" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stop-color="#fafafa"/>
              <stop offset="100%" stop-color="#eaeaea"/>
            </radialGradient>
          </defs>

          <!-- outer rim -->
          <circle r="49" fill="url(#rim)" stroke="rgba(0,0,0,.08)" stroke-width="1"></circle>

          <!-- inner ring to add depth -->
          <circle r="44.2" fill="url(#inner)" stroke="#ddd" stroke-width=".6"></circle>

          <g id="segments"></g>
          <g id="ticks" stroke="#000" stroke-opacity=".12" stroke-width=".28"></g>

          <!-- hub -->
          <circle r="10.8" fill="#0f0f10" stroke="#4a4a4a" stroke-width="1.1"></circle>
          <circle r="7.2" fill="url(#absa-red-grad)" stroke="#fff" stroke-width=".8"></circle>
          <text y="2" text-anchor="middle" fill="white" font-size="3.2" font-weight="800" aria-hidden="true">ABSA</text>

          <!-- gloss -->
          <circle r="49" fill="url(#gloss)" stroke="none" pointer-events="none"></circle>
        </svg>
      </div>
    </section>

    <section class="controls" aria-label="Controls">
      <button id="spinBtn" type="button" aria-controls="wheel" aria-label="Start spin (or press Space)">üéØ Spin Wheel</button>
      <button id="resetBtn" type="button" aria-label="Reset wheel">‚Ü∫ Reset Wheel</button>
      <div id="status" class="readout" role="status">Ready. Press <strong>Spin Wheel</strong> or <strong>Space</strong> to start.</div>
    </section>

    <div id="toast" class="toast" role="status" aria-live="assertive"></div>
  </main>

<script>
/* ======= CONFIG ======= */
const PRIZES = ["R100 Gift Card", "Movie Tickets", "Coffee Hamper", "ABSA Merch Pack"];

const WHEEL = document.getElementById('wheel');
const SEG_GROUP = document.getElementById('segments');
const TICK_GROUP = document.getElementById('ticks');
const STATUS = document.getElementById('status');
const BTN_SPIN = document.getElementById('spinBtn');
const BTN_RESET = document.getElementById('resetBtn');
const TOAST = document.getElementById('toast');
const CONFETTI = document.getElementById('confetti');

const SEG_SIZE = 45;               // degrees per segment (8 total)
const CENTER_OFFSET = SEG_SIZE/2;  // 22.5¬∞
const FULL = 360;
const R = 46;     // slice radius inside rim
const TXT_R = 30; // text radius for readability

let spinning = false;
let currentRotation = 0;

/* Build segments list */
const segments = [
  { label: PRIZES[0], type: 'win' },
  { label: 'Try Again', type: 'try' },
  { label: PRIZES[1], type: 'win' },
  { label: 'Extra Spin', type: 'extra' },
  { label: PRIZES[2], type: 'win' },
  { label: 'Try Again', type: 'try' },
  { label: PRIZES[3], type: 'win' },
  { label: 'Extra Spin', type: 'extra' },
];

/* ABSA Color palette */
const FILL_A = '#ffffff';
const FILL_B = '#f7f7f7';
const TEXT_WIN = '#E41E2D';
const TEXT_TRY = '#666666';
const TEXT_EXTRA = '#000000';

/* ======= SVG helpers ======= */
function polarToXY(deg, radius){
  const rad = (deg - 90) * Math.PI / 180; // start from top
  return { x: radius * Math.cos(rad), y: radius * Math.sin(rad) };
}

function describeSlice(startDeg, endDeg, radius){
  const start = polarToXY(startDeg, radius);
  const end   = polarToXY(endDeg, radius);
  const large = endDeg - startDeg <= 180 ? 0 : 1;
  return `M 0 0 L ${start.x.toFixed(3)} ${start.y.toFixed(3)} A ${radius} ${radius} 0 ${large} 1 ${end.x.toFixed(3)} ${end.y.toFixed(3)} Z`;
}

function addTextAt(angleDeg, text, color){
  const anchor = polarToXY(angleDeg, TXT_R);
  const g = document.createElementNS('http://www.w3.org/2000/svg','g');
  g.setAttribute('transform', `translate(${anchor.x.toFixed(2)}, ${anchor.y.toFixed(2)})`);
  const bg = document.createElementNS('http://www.w3.org/2000/svg','rect');
  const t  = document.createElementNS('http://www.w3.org/2000/svg','text');

  t.textContent = text;
  t.setAttribute('fill', color);
  t.setAttribute('font-size', '2.6');   // smaller labels (was 3.5)
  t.setAttribute('font-weight', '800');
  t.setAttribute('text-anchor','middle');
  t.setAttribute('dominant-baseline','central');

  // chip bg for legibility
  const padX = Math.max(10, text.length * 1.8);
  const padY = 6;
  bg.setAttribute('x', (-padX/2).toString());
  bg.setAttribute('y', (-padY/2).toString());
  bg.setAttribute('width', padX.toString());
  bg.setAttribute('height', padY.toString());
  bg.setAttribute('class','label-chip');

  g.appendChild(bg);
  g.appendChild(t);
  SEG_GROUP.appendChild(g);
}

function buildWheel(){
  SEG_GROUP.innerHTML = '';
  TICK_GROUP.innerHTML = '';

  for (let i=0; i<8; i++){
    const start = i * SEG_SIZE;
    const end   = (i+1) * SEG_SIZE;
    const center= start + CENTER_OFFSET;
    const seg   = segments[i];

    // slice
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d', describeSlice(start, end, R));
    // Use ABSA red for winning segments, alternating light colors for others
    if (seg.type === 'win') {
      path.setAttribute('fill', 'url(#absa-red-grad)');
    } else {
      path.setAttribute('fill', (i % 2 === 0) ? FILL_A : FILL_B);
    }
    path.setAttribute('stroke', 'rgba(0,0,0,.08)');
    path.setAttribute('stroke-width', '.6');
    SEG_GROUP.appendChild(path);

    // text
    let color = TEXT_EXTRA;
    if (seg.type === 'win')  color = TEXT_WIN;
    if (seg.type === 'try')  color = TEXT_TRY;
    addTextAt(center, seg.label, color);

    // tick marks
    const tick = document.createElementNS('http://www.w3.org/2000/svg','line');
    const a = polarToXY(start, R+0.2);
    const b = polarToXY(start, R-4);
    tick.setAttribute('x1', a.x.toFixed(2));
    tick.setAttribute('y1', a.y.toFixed(2));
    tick.setAttribute('x2', b.x.toFixed(2));
    tick.setAttribute('y2', b.y.toFixed(2));
    tick.setAttribute('stroke', 'rgba(0,0,0,.12)');
    tick.setAttribute('stroke-width', '.45');
    TICK_GROUP.appendChild(tick);
  }
}
buildWheel();

/* ======= Spin Logic ======= */
function pickIndexFair(){
  return Math.floor(Math.random() * segments.length);
}

function celebrate(){
  const ctx = CONFETTI.getContext('2d');
  const rect = document.querySelector('.stage').getBoundingClientRect();
  const width = rect.width, height = rect.height;

  // scale for crispness
  const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
  CONFETTI.width = width * dpr;
  CONFETTI.height = height * dpr;
  ctx.scale(dpr, dpr);

  const pieces = Array.from({length: 120}, () => ({
    x: Math.random()*width,
    y: -10 + Math.random()*10,
    w: 3 + Math.random()*4,
    h: 6 + Math.random()*6,
    v: 2 + Math.random()*3,
    a: Math.random()*FULL,
    s: 2 + Math.random()*3
  }));

  let frames = 0;
  function step(){
    ctx.clearRect(0,0,width,height);
    pieces.forEach(p=>{
      p.y += p.v;
      p.a += p.s;
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.a*Math.PI/180);
      ctx.fillStyle = ['#E41E2D','#000000','#FFC72C','#FFFFFF'][Math.floor(Math.random()*4)];
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    });
    frames++;
    if (frames < 100) requestAnimationFrame(step);
    else ctx.clearRect(0,0,width,height);
  }
  step();
}

function showToast(html, nice=false){
  TOAST.innerHTML = html;
  TOAST.classList.toggle('win', !!nice);
  TOAST.classList.add('show');
  setTimeout(()=> TOAST.classList.remove('show'), 2600);
}

function spin(){
  if (spinning) return;
  spinning = true;
  document.body.classList.add('spinning');
  BTN_SPIN.disabled = true;
  BTN_RESET.disabled = true;
  STATUS.innerHTML = 'Spinning‚Ä¶';

  const idx = pickIndexFair();
  const targetCenterAngle = idx * SEG_SIZE + CENTER_OFFSET;

  // add several full turns for satisfaction
  const fullTurns = 8 + Math.floor(Math.random()*4); // 8‚Äì11
  const jitter = (Math.random()*6) - 3; // ¬±3¬∞

  // We rotate from currentRotation to newRotation
  const finalRotation = (fullTurns * FULL) - targetCenterAngle + jitter;

  // animate via CSS transform on the SVG element container
  const node = WHEEL;
  node.style.transition = `transform var(--spin-ms) var(--bezier)`;
  node.style.transform = `rotate(${finalRotation}deg)`;
  currentRotation = finalRotation;

  // After spin ends, announce result
  const ms = getComputedStyle(document.documentElement).getPropertyValue('--spin-ms').trim();
  const dur = ms.endsWith('ms') ? parseFloat(ms) : parseFloat(ms)*1000;

  setTimeout(()=>{
    const result = segments[idx];
    let msg;
    if (result.type === 'win'){
      msg = `üéâ You won <strong>${result.label}</strong>!`;
      showToast(`Congratulations! You won: <strong>${result.label}</strong>`, true);
      celebrate();
    } else if (result.type === 'extra'){
      msg = `‚Üª <strong>${result.label}</strong> ‚Äî spin again!`;
      showToast('Extra spin unlocked! Try again.', false);
    } else {
      msg = `üôÇ <strong>${result.label}</strong>. Better luck next time!`;
      showToast('Try again ‚Äî your next spin could be a winner!', false);
    }
    STATUS.innerHTML = msg;
    spinning = false;
    document.body.classList.remove('spinning');
    BTN_SPIN.disabled = false;
    BTN_RESET.disabled = false;
  }, dur + 60);
}

function resetWheel(){
  if (spinning) return;
  WHEEL.style.transition = 'transform 380ms ease';
  WHEEL.style.transform = 'rotate(0deg)';
  currentRotation = 0;
  STATUS.innerHTML = 'Wheel reset. Press <strong>Spin Wheel</strong> to play.';
}

/* ======= Events & A11y ======= */
BTN_SPIN.addEventListener('click', spin);
BTN_RESET.addEventListener('click', resetWheel);

document.addEventListener('keydown', (e)=>{
  // Space or Enter will spin; R resets
  if (e.code === 'Space' || e.key === 'Enter'){
    e.preventDefault();
    spin();
  } else if ((e.key === 'r' || e.key === 'R') && !spinning){
    resetWheel();
  }
});

/* Make confetti canvas match stage */
function sizeConfetti(){
  const rect = document.querySelector('.stage').getBoundingClientRect();
  // regular size; drawing scale handled in celebrate()
  CONFETTI.width = rect.width;
  CONFETTI.height = rect.height;
}
window.addEventListener('resize', sizeConfetti, { passive:true });
sizeConfetti();

</script>
</body>
</html>
